#!/usr/bin/env python3
import os
import sys
from subprocess import call, DEVNULL
from os.path import exists, isdir

from edit_helpers import run_editor


def main():
    path = file_to_edit()
    validate_path(path)
    if os.getenv('INSIDE_EMACS'):
        call([
            'emacsclient',
            '-e', '(find-file-other-window "{}")'.format(path),
        ])
    else:
        call(['emacsclient', '--no-wait', path])


def file_to_edit():
    if len(sys.argv) == 1:
        print('Specify the file to edit.')
        sys.exit(1)
    elif len(sys.argv) > 2:
        print('This program only takes 1 argument.')
        sys.exit(1)
    return sys.argv[1]


def validate_path(path):
    if not exists(path):
        print('Path {} does not exist.'.format(repr(path)))
        sys.exit(1)
    if isdir(path) and not path.endswith('/'):
        print("Path {} is a directory. To open it, put '/' at the end of the "
              "path.".format(repr(path)))
        sys.exit(1)


# def get_editors(path):
#     cmds = [
#         ['vim', path],
#         ['vi', path],
#     ]
#     if os.getenv('INSIDE_EMACS'):
#         cmds = [[
#             'emacsclient',
#             '-a', 'vim',
#             '-e', '(find-file-other-window "{}")'.format(path),
#         ]] + cmds
#     return cmds


if __name__ == '__main__':
    main()
